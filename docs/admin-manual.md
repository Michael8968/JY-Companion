# æ˜Ÿæ¾œå­¦ä¼´ -- ç®¡ç†å‘˜æ“ä½œæ‰‹å†Œ

> ç‰ˆæœ¬ï¼šv0.1.0 | é€‚ç”¨è§’è‰²ï¼šç³»ç»Ÿç®¡ç†å‘˜ã€å­¦æ ¡ IT è¿ç»´äººå‘˜

---

## ç›®å½•

1. [ç®¡ç†åå°æ¦‚è§ˆ](#1-ç®¡ç†åå°æ¦‚è§ˆ)
2. [ç”¨æˆ·ç®¡ç†](#2-ç”¨æˆ·ç®¡ç†)
3. [æ•°æ®ç»Ÿè®¡](#3-æ•°æ®ç»Ÿè®¡)
4. [å±æœºé¢„è­¦ç®¡ç†](#4-å±æœºé¢„è­¦ç®¡ç†)
5. [å†…å®¹å®¡æ ¸](#5-å†…å®¹å®¡æ ¸)
6. [ç³»ç»Ÿé…ç½®](#6-ç³»ç»Ÿé…ç½®)
7. [SSO é›†æˆ](#7-sso-é›†æˆ)
8. [å¸¸è§è¿ç»´æ“ä½œ](#8-å¸¸è§è¿ç»´æ“ä½œ)

---

## 1. ç®¡ç†åå°æ¦‚è§ˆ

### 1.1 ç™»å½•ç®¡ç†åå°

ç®¡ç†åå°åŠŸèƒ½é›†æˆåœ¨æ˜Ÿæ¾œå­¦ä¼´åº”ç”¨å†…ï¼Œä»…å¯¹ **admin è§’è‰²** ç”¨æˆ·å¯è§ã€‚

**ç™»å½•æ­¥éª¤ï¼š**

1. ä½¿ç”¨ç®¡ç†å‘˜è´¦å·ç™»å½•æ˜Ÿæ¾œå­¦ä¼´åº”ç”¨ï¼ˆç”¨æˆ·åå’Œå¯†ç ä¸æ™®é€šç”¨æˆ·ç›¸åŒçš„ç™»å½•æµç¨‹ï¼‰ã€‚
2. ç™»å½•åè¿›å…¥é¦–é¡µï¼Œç‚¹å‡»åº•éƒ¨å¯¼èˆªæ  **ã€Œæˆ‘çš„ã€** æ ‡ç­¾ã€‚
3. åœ¨ä¸ªäººé¡µé¢ä¸­ï¼Œç®¡ç†å‘˜è§’è‰²ç”¨æˆ·ä¼šçœ‹åˆ° **ã€Œç®¡ç†åå°ã€** å…¥å£ï¼ˆä½äº"è´¦å·ä¿¡æ¯"ä¸Šæ–¹ï¼‰ã€‚
4. ç‚¹å‡» **ã€Œç®¡ç†åå°ã€** è¿›å…¥åå°ç®¡ç†ç•Œé¢ã€‚

> **æƒé™è¯´æ˜ï¼š** åªæœ‰ `role` ä¸º `admin` çš„ç”¨æˆ·æ‰èƒ½çœ‹åˆ°å¹¶è¿›å…¥ç®¡ç†åå°ã€‚æ•™å¸ˆè§’è‰²ï¼ˆ`teacher`ï¼‰å¯ä»¥é€šè¿‡ API è®¿é—®é¢„è­¦åˆ—è¡¨ï¼Œä½†æ— æ³•è¿›å…¥å®Œæ•´ç®¡ç†åå°ç•Œé¢ã€‚

### 1.2 ä»ªè¡¨ç›˜

ç®¡ç†åå°ä¸»ç•Œé¢åŒ…å«ä¸‰ä¸ªæ ‡ç­¾é¡µï¼š

| æ ‡ç­¾ | å›¾æ ‡ | åŠŸèƒ½ |
|------|------|------|
| æ•°æ®ç»Ÿè®¡ | ğŸ“Š | æŸ¥çœ‹å¹³å°æ•´ä½“è¿è¥æ•°æ® |
| ç”¨æˆ·ç®¡ç† | ğŸ‘¥ | ç®¡ç†ç”¨æˆ·è´¦å·å’ŒçŠ¶æ€ |
| é¢„è­¦å¤„ç† | âš ï¸ | æŸ¥çœ‹å’Œå¤„ç†å±æœºé¢„è­¦ |

è¿›å…¥ç®¡ç†åå°æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åŠ è½½ä¸‰ä¸ªæ ‡ç­¾é¡µçš„æ•°æ®ã€‚

---

## 2. ç”¨æˆ·ç®¡ç†

### 2.1 ç”¨æˆ·åˆ—è¡¨

åˆ‡æ¢åˆ° **ã€Œç”¨æˆ·ç®¡ç†ã€** æ ‡ç­¾é¡µï¼ŒæŸ¥çœ‹å¹³å°æ‰€æœ‰æ³¨å†Œç”¨æˆ·ï¼š

- åˆ—è¡¨æŒ‰æ³¨å†Œæ—¶é—´å€’åºæ’åˆ—ï¼Œæœ€æ–°æ³¨å†Œçš„ç”¨æˆ·æ’åœ¨æœ€å‰é¢ã€‚
- æ¯ä¸ªç”¨æˆ·å¡ç‰‡æ˜¾ç¤ºï¼š
  - **ç”¨æˆ·å** -- ç”¨æˆ·çš„ç™»å½•è´¦å·
  - **è§’è‰²** -- å­¦ç”Ÿ / æ•™å¸ˆ / å®¶é•¿ / ç®¡ç†å‘˜
  - **è´¦å·çŠ¶æ€** -- "æ­£å¸¸" æˆ– "å·²åœç”¨"
  - **çŠ¶æ€å¼€å…³** -- å³ä¾§ Switch æ§ä»¶

æ”¯æŒä¸‹æ‹‰åˆ·æ–°è·å–æœ€æ–°ç”¨æˆ·æ•°æ®ã€‚

**åç«¯ APIï¼š** `GET /api/v1/admin/users`
- å‚æ•°ï¼š`page`ï¼ˆé¡µç ï¼Œé»˜è®¤ 1ï¼‰ã€`size`ï¼ˆæ¯é¡µæ¡æ•°ï¼Œé»˜è®¤ 20ï¼Œæœ€å¤§ 100ï¼‰ã€`role`ï¼ˆå¯é€‰ç­›é€‰è§’è‰²ï¼‰
- éœ€è¦ admin è§’è‰²æƒé™

### 2.2 è´¦å·çŠ¶æ€ç®¡ç†

ç®¡ç†å‘˜å¯ä»¥å¯ç”¨æˆ–åœç”¨ç”¨æˆ·è´¦å·ï¼š

1. åœ¨ç”¨æˆ·åˆ—è¡¨ä¸­æ‰¾åˆ°ç›®æ ‡ç”¨æˆ·ã€‚
2. ç‚¹å‡»ç”¨æˆ·å¡ç‰‡å³ä¾§çš„ **çŠ¶æ€å¼€å…³ï¼ˆSwitchï¼‰**ï¼š
   - **å¼€å¯** = æ­£å¸¸çŠ¶æ€ï¼Œç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•ä½¿ç”¨
   - **å…³é—­** = åœç”¨çŠ¶æ€ï¼Œç”¨æˆ·æ— æ³•ç™»å½•
3. çŠ¶æ€å˜æ›´å³æ—¶ç”Ÿæ•ˆã€‚

**ä½¿ç”¨åœºæ™¯ï¼š**

- å­¦ç”Ÿæ¯•ä¸šæˆ–è½¬å­¦ååœç”¨è´¦å·
- å‘ç°è¿è§„è¡Œä¸ºåä¸´æ—¶åœç”¨è´¦å·
- è¯¯æ“ä½œåé‡æ–°å¯ç”¨è´¦å·

**åç«¯ APIï¼š** `PUT /api/v1/admin/users/{user_id}/status`
- è¯·æ±‚ä½“ï¼š`{ "is_active": true/false }`
- éœ€è¦ admin è§’è‰²æƒé™

### 2.3 è§’è‰²åˆ†é…

ç›®å‰ç”¨æˆ·è§’è‰²åœ¨æ³¨å†Œæ—¶é€‰æ‹©ï¼Œæ”¯æŒå››ç§è§’è‰²ï¼š

| è§’è‰² | å€¼ | æƒé™èŒƒå›´ |
|------|-----|---------|
| å­¦ç”Ÿ | `student` | ä½¿ç”¨æ‰€æœ‰å­¦ä¹ åŠŸèƒ½æ¨¡å—ï¼Œé™æµ 100 æ¬¡/åˆ†é’Ÿ |
| æ•™å¸ˆ | `teacher` | ä½¿ç”¨å­¦ä¹ åŠŸèƒ½ + æŸ¥çœ‹å­¦ç”Ÿæ•°æ® + æŸ¥çœ‹é¢„è­¦ï¼Œé™æµ 500 æ¬¡/åˆ†é’Ÿ |
| å®¶é•¿ | `parent` | æŸ¥çœ‹å­å¥³å­¦ä¹ å’Œæƒ…ç»ªæ•°æ® |
| ç®¡ç†å‘˜ | `admin` | æ‰€æœ‰æƒé™ + ç®¡ç†åå° + ç”¨æˆ·ç®¡ç† + ç³»ç»Ÿé…ç½® |

> **æ³¨æ„ï¼š** å¦‚éœ€æ›´æ”¹ç”¨æˆ·è§’è‰²ï¼ˆä¾‹å¦‚å°†æ™®é€šç”¨æˆ·æå‡ä¸ºç®¡ç†å‘˜ï¼‰ï¼Œå½“å‰éœ€é€šè¿‡åç«¯æ•°æ®åº“ç›´æ¥ä¿®æ”¹ `users` è¡¨çš„ `role` å­—æ®µï¼š
>
> ```sql
> UPDATE users SET role = 'admin' WHERE username = 'ç›®æ ‡ç”¨æˆ·å';
> ```

---

## 3. æ•°æ®ç»Ÿè®¡

### 3.1 å¹³å°ä½¿ç”¨ç»Ÿè®¡

åˆ‡æ¢åˆ° **ã€Œæ•°æ®ç»Ÿè®¡ã€** æ ‡ç­¾é¡µï¼ŒæŸ¥çœ‹å¹³å°æ ¸å¿ƒæŒ‡æ ‡ï¼š

| æŒ‡æ ‡ | å›¾æ ‡ | è¯´æ˜ |
|------|------|------|
| æ€»ç”¨æˆ·æ•° | ğŸ‘¥ | å¹³å°æ³¨å†Œç”¨æˆ·æ€»æ•° |
| ä»Šæ—¥æ´»è·ƒ | ğŸ“… | ä»Šæ—¥ç™»å½•ä½¿ç”¨çš„ç”¨æˆ·æ•° |
| æ€»ä¼šè¯æ•° | ğŸ’¬ | å¹³å°æ‰€æœ‰ AI å¯¹è¯ä¼šè¯æ€»æ•° |
| æ€»æ¶ˆæ¯æ•° | ğŸ“¨ | å¹³å°æ‰€æœ‰å¯¹è¯æ¶ˆæ¯æ€»æ•° |
| å¾…å¤„ç†é¢„è­¦ | âš ï¸ | å½“å‰çŠ¶æ€ä¸º"active"çš„å±æœºé¢„è­¦æ•°é‡ï¼ˆçº¢è‰²é«˜äº®ï¼‰ |
| å¹³å‡å“åº”æ—¶é—´ | â±ï¸ | AI å“åº”ç”¨æˆ·æ¶ˆæ¯çš„å¹³å‡å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰ |

**åç«¯ APIï¼š** `GET /api/v1/admin/stats`
- è¿”å›ï¼š`total_users`ã€`active_users_today`ã€`total_conversations`ã€`total_messages`ã€`active_crisis_alerts`ã€`avg_response_time_ms`
- éœ€è¦ admin è§’è‰²æƒé™

### 3.2 å„æ™ºèƒ½ä½“ä½¿ç”¨æƒ…å†µ

å¹³å°åŒ…å«å…­ä¸ª AI æ™ºèƒ½ä½“ï¼Œå„æ™ºèƒ½ä½“çš„ä½¿ç”¨æ•°æ®å¯é€šè¿‡å¯¹è¯ä¼šè¯çš„ `agent_type` å­—æ®µè¿›è¡Œç»Ÿè®¡åˆ†æï¼š

| æ™ºèƒ½ä½“ | agent_type | åŠŸèƒ½å®šä½ |
|--------|-----------|---------|
| å­¦ä¸šè¾…å¯¼ | `academic` | é¢˜ç›®è§£ç­”ã€åˆ†æ­¥è®²è§£ã€é”™é¢˜ç®¡ç† |
| è¯¾å ‚å¤ç›˜ | `classroom` | å½•éŸ³è½¬å†™ã€è¯¾å ‚æ‘˜è¦ã€å­¦æ¡ˆç”Ÿæˆ |
| æƒ…æ„Ÿé™ªä¼´ | `emotional` | æƒ…ç»ªè¯†åˆ«ã€å¿ƒç†å…³æ€€ã€æ”¾æ¾å¼•å¯¼ |
| å¥åº·å®ˆæŠ¤ | `health` | å±å¹•æ—¶é—´ã€è¿åŠ¨è®¡åˆ’ã€ä¹…åæé†’ |
| åˆ›æ„åˆ›ä½œ | `creative` | åˆ›æ„ç”Ÿæˆã€ä½œå“è¯„ä»·ã€ä½œå“åº“ |
| ç”Ÿæ¶¯è§„åˆ’ | `career` | ç›®æ ‡ç®¡ç†ã€è¿›åº¦æŠ¥å‘Šã€ç”˜ç‰¹å›¾ |

å¦‚éœ€è·å–å„æ™ºèƒ½ä½“çš„è¯¦ç»†ä½¿ç”¨æ•°æ®ï¼ˆå¦‚æ—¥æ´»ã€ä¼šè¯é‡ã€æ¶ˆæ¯é‡ç­‰ï¼‰ï¼Œå¯é€šè¿‡ç›´æ¥æŸ¥è¯¢æ•°æ®åº“å®ç°ï¼š

```sql
-- å„æ™ºèƒ½ä½“ä¼šè¯æ•°é‡ç»Ÿè®¡
SELECT agent_type, COUNT(*) as session_count
FROM conversations
GROUP BY agent_type
ORDER BY session_count DESC;

-- å„æ™ºèƒ½ä½“è¿‘7æ—¥æ¶ˆæ¯é‡
SELECT c.agent_type, COUNT(m.id) as message_count
FROM messages m
JOIN conversations c ON m.conversation_id = c.id
WHERE m.created_at > NOW() - INTERVAL '7 days'
GROUP BY c.agent_type
ORDER BY message_count DESC;
```

---

## 4. å±æœºé¢„è­¦ç®¡ç†

å±æœºé¢„è­¦ç³»ç»Ÿæ˜¯å¹³å°çš„æ ¸å¿ƒå®‰å…¨åŠŸèƒ½ï¼Œå½“ AI åœ¨å¯¹è¯ä¸­æ£€æµ‹åˆ°å­¦ç”Ÿå¯èƒ½å­˜åœ¨å¿ƒç†å±æœºä¿¡å·æ—¶ï¼Œè‡ªåŠ¨è§¦å‘é¢„è­¦ã€‚

### 4.1 é¢„è­¦åˆ—è¡¨

åˆ‡æ¢åˆ° **ã€Œé¢„è­¦å¤„ç†ã€** æ ‡ç­¾é¡µï¼š

- åˆ—è¡¨æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—ï¼Œæœ€æ–°é¢„è­¦æ’åœ¨æœ€å‰é¢ã€‚
- æ¯æ¡é¢„è­¦å¡ç‰‡æ˜¾ç¤ºï¼š
  - **é¢„è­¦çº§åˆ«** -- æ ¹æ®å±æœºä¸¥é‡ç¨‹åº¦åˆ†çº§
  - **é¢„è­¦çŠ¶æ€** -- activeï¼ˆå¾…å¤„ç†ï¼‰/ resolvedï¼ˆå·²è§£å†³ï¼‰
  - **è§¦å‘ç”¨æˆ·** -- è§¦å‘é¢„è­¦çš„ç”¨æˆ· ID
  - **è§¦å‘å†…å®¹** -- è§¦å‘é¢„è­¦çš„å¯¹è¯å†…å®¹æ‘˜è¦ï¼ˆå·²è„±æ•ï¼Œæœ€å¤š 50 å­—ï¼‰
- å¾…å¤„ç†é¢„è­¦ï¼ˆactive çŠ¶æ€ï¼‰ä»¥æµ…çº¢è‰²èƒŒæ™¯é«˜äº®æ˜¾ç¤ºï¼Œå³ä¾§æœ‰ **ã€Œå¤„ç†ã€** æŒ‰é’®ã€‚
- å·²è§£å†³é¢„è­¦æ— é«˜äº®ï¼Œæ— æ“ä½œæŒ‰é’®ã€‚

æ”¯æŒä¸‹æ‹‰åˆ·æ–°è·å–æœ€æ–°é¢„è­¦æ•°æ®ã€‚

**åç«¯ APIï¼š** `GET /api/v1/admin/alerts`
- å‚æ•°ï¼š`page`ã€`size`ã€`status`ï¼ˆå¯é€‰ç­›é€‰çŠ¶æ€ï¼‰
- admin å’Œ teacher è§’è‰²å‡å¯è®¿é—®
- è§¦å‘å†…å®¹ç»è¿‡ `DataMaskingEngine` æˆªæ–­è„±æ•å¤„ç†

### 4.2 é¢„è­¦å¤„ç†æµç¨‹

å½“æ”¶åˆ°æ–°çš„å±æœºé¢„è­¦æ—¶ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹æµç¨‹å¤„ç†ï¼š

```
æ”¶åˆ°é¢„è­¦ â†’ æŸ¥çœ‹é¢„è­¦è¯¦æƒ… â†’ è¯„ä¼°ä¸¥é‡ç¨‹åº¦ â†’ è”ç³»ç›¸å…³äººå‘˜ â†’ ç¡®è®¤è§£å†³ â†’ è®°å½•å¤‡æ³¨
```

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **åŠæ—¶æŸ¥çœ‹** -- å»ºè®®ç®¡ç†å‘˜å’Œå¿ƒç†è€å¸ˆæ¯æ—¥è‡³å°‘æŸ¥çœ‹ä¸¤æ¬¡é¢„è­¦åˆ—è¡¨ï¼Œç¡®ä¿æ— é—æ¼ã€‚
2. **è¯„ä¼°çº§åˆ«** -- æ ¹æ®é¢„è­¦çº§åˆ«å’Œè§¦å‘å†…å®¹åˆ¤æ–­ç´§æ€¥ç¨‹åº¦ï¼š
   - é«˜çº§åˆ«é¢„è­¦åº”åœ¨ 1 å°æ—¶å†…å“åº”
   - ä¸­çº§åˆ«é¢„è­¦åº”åœ¨å½“æ—¥å†…å¤„ç†
   - ä½çº§åˆ«é¢„è­¦åº”åœ¨ 3 ä¸ªå·¥ä½œæ—¥å†…å¤„ç†
3. **è”ç³»ç›¸å…³äººå‘˜** -- æ ¹æ®æƒ…å†µè”ç³»ç­ä¸»ä»»ã€å¿ƒç†è€å¸ˆã€å®¶é•¿ç­‰ç›¸å…³äººå‘˜ã€‚
4. **çº¿ä¸‹å¹²é¢„** -- æŒ‰ç…§å­¦æ ¡å¿ƒç†å¥åº·å·¥ä½œè§„èŒƒè¿›è¡Œçº¿ä¸‹è·Ÿè¿›ã€‚
5. **ç¡®è®¤è§£å†³** -- çº¿ä¸‹å¤„ç†å®Œæ¯•åï¼Œåœ¨ç³»ç»Ÿä¸­æ ‡è®°é¢„è­¦ä¸ºå·²è§£å†³ã€‚

### 4.3 é¢„è­¦ç¡®è®¤ä¸è§£å†³

1. åœ¨é¢„è­¦åˆ—è¡¨ä¸­ç‚¹å‡»å¾…å¤„ç†é¢„è­¦çš„ **ã€Œå¤„ç†ã€** æŒ‰é’®ã€‚
2. å¼¹å‡ºå¯¹è¯æ¡†æ˜¾ç¤ºï¼š
   - **é¢„è­¦çº§åˆ«** -- å½“å‰é¢„è­¦çš„ä¸¥é‡ç¨‹åº¦
   - **è§¦å‘å†…å®¹** -- è§¦å‘é¢„è­¦çš„å¯¹è¯å†…å®¹
   - **å¤„ç†å¤‡æ³¨** -- æ–‡æœ¬è¾“å…¥æ¡†ï¼Œé€‰å¡«ï¼Œç”¨äºè®°å½•å¤„ç†æªæ–½å’Œç»“æœ
3. å¡«å†™å¤„ç†å¤‡æ³¨åï¼Œç‚¹å‡» **ã€Œç¡®è®¤è§£å†³ã€** æŒ‰é’®ã€‚
4. é¢„è­¦çŠ¶æ€æ›´æ–°ä¸º resolvedï¼Œä»é«˜äº®åˆ—è¡¨ä¸­ç§»é™¤ã€‚

**åç«¯ APIï¼š** `PUT /api/v1/admin/alerts/{alert_id}/resolve`
- å‚æ•°ï¼š`notes`ï¼ˆé€‰å¡«å¤„ç†å¤‡æ³¨ï¼‰
- admin å’Œ teacher è§’è‰²å‡å¯æ“ä½œ

> **é‡è¦æç¤ºï¼š** é¢„è­¦ç¡®è®¤ä»…è¡¨ç¤ºç³»ç»Ÿå±‚é¢çš„æ ‡è®°ï¼Œå®é™…çš„å¿ƒç†å¹²é¢„å’Œåç»­è·Ÿè¿›å·¥ä½œå¿…é¡»åœ¨çº¿ä¸‹æŒ‰ç…§å­¦æ ¡è§„èŒƒæµç¨‹å®Œæˆã€‚åˆ‡å‹¿ä»…åœ¨ç³»ç»Ÿä¸­æ ‡è®°è§£å†³è€Œå¿½ç•¥çº¿ä¸‹è·Ÿè¿›ã€‚

---

## 5. å†…å®¹å®¡æ ¸

### 5.1 å†…å®¹å®‰å…¨ç­–ç•¥é…ç½®

å¹³å°å†…ç½®å†…å®¹å®‰å…¨æ£€æµ‹å¼•æ“ï¼Œé€šè¿‡åç«¯é…ç½®æ§åˆ¶ï¼š

**ç¯å¢ƒå˜é‡é…ç½®ï¼ˆbackend/.envï¼‰ï¼š**

```env
# å†…å®¹å®‰å…¨å¼€å…³
CONTENT_SAFETY_ENABLED=true
```

å½“ `CONTENT_SAFETY_ENABLED` ä¸º `true` æ—¶ï¼Œç³»ç»Ÿä¼šå¯¹ä»¥ä¸‹å†…å®¹è¿›è¡Œå®‰å…¨æ£€æµ‹ï¼š

- ç”¨æˆ·å‘é€çš„å¯¹è¯æ¶ˆæ¯
- AI ç”Ÿæˆçš„å›å¤å†…å®¹
- åˆ›æ„åˆ›ä½œä¸­çš„ç”¨æˆ·è¾“å…¥å’Œç”Ÿæˆç»“æœ

### 5.2 è¿è§„å†…å®¹å¤„ç†

å½“æ£€æµ‹åˆ°è¿è§„å†…å®¹æ—¶ï¼Œç³»ç»Ÿçš„å¤„ç†ç­–ç•¥ï¼š

1. **è‡ªåŠ¨æ‹¦æˆª** -- åŒ…å«è¿è§„å…³é”®è¯æˆ–ä¸å½“å†…å®¹çš„æ¶ˆæ¯ä¼šè¢«è‡ªåŠ¨æ‹¦æˆªï¼Œä¸ä¼šå‘é€åˆ° AI æ¨¡å‹ã€‚
2. **å±æœºé¢„è­¦** -- å¦‚æœå†…å®¹åŒ…å«å¿ƒç†å±æœºä¿¡å·ï¼ˆå¦‚è‡ªä¼¤ã€è‡ªæ€ç›¸å…³è¡¨è¿°ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºå±æœºé¢„è­¦ï¼Œé€šçŸ¥ç®¡ç†å‘˜å’Œæ•™å¸ˆã€‚
3. **æ•°æ®è„±æ•** -- ç®¡ç†ç«¯æŸ¥çœ‹é¢„è­¦æ—¶ï¼Œæ•æ„Ÿå†…å®¹ä¼šé€šè¿‡ `DataMaskingEngine` è¿›è¡Œæˆªæ–­è„±æ•å¤„ç†ï¼ˆæœ€å¤šæ˜¾ç¤º 50 ä¸ªå­—ç¬¦ï¼‰ã€‚

**è‡ªå®šä¹‰å®‰å…¨ç­–ç•¥ï¼š**

å¦‚éœ€è°ƒæ•´å†…å®¹å®‰å…¨æ£€æµ‹è§„åˆ™ï¼ˆå¦‚æ·»åŠ è‡ªå®šä¹‰è¿è§„è¯åº“ã€è°ƒæ•´æ£€æµ‹çµæ•åº¦ï¼‰ï¼Œéœ€è¦ä¿®æ”¹åç«¯ä»£ç ï¼š

- å†…å®¹å®‰å…¨æœåŠ¡ï¼š`backend/app/services/` ç›®å½•ä¸‹çš„ç›¸å…³æœåŠ¡æ¨¡å—
- é¢„è­¦è§¦å‘é€»è¾‘ï¼šä¸æƒ…ç»ªæ£€æµ‹æœåŠ¡ `EmotionDetector` è”åŠ¨

---

## 6. ç³»ç»Ÿé…ç½®

### 6.1 é™æµé…ç½®

å¹³å°å¯¹ä¸åŒè§’è‰²è®¾ç½®äº† API è°ƒç”¨é¢‘ç‡é™åˆ¶ï¼Œé˜²æ­¢æ»¥ç”¨ï¼š

| è§’è‰² | é™æµè§„åˆ™ | é…ç½®é¡¹ |
|------|---------|--------|
| å­¦ç”Ÿ | 100 æ¬¡/åˆ†é’Ÿ | `RATE_LIMIT_STUDENT` |
| æ•™å¸ˆ | 500 æ¬¡/åˆ†é’Ÿ | `RATE_LIMIT_TEACHER` |

**ä¿®æ”¹æ–¹å¼ï¼š** ç¼–è¾‘ `backend/.env` æ–‡ä»¶ï¼š

```env
RATE_LIMIT_STUDENT=100/minute
RATE_LIMIT_TEACHER=500/minute
```

ä¿®æ”¹åéœ€è¦é‡å¯åç«¯æœåŠ¡ç”Ÿæ•ˆã€‚é™æµåŸºäº Redis å®ç°ï¼Œç¡®ä¿ Redis æœåŠ¡æ­£å¸¸è¿è¡Œã€‚

### 6.2 JWT ä»¤ç‰Œé…ç½®

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `JWT_SECRET_KEY` | change-me-in-production | JWT ç­¾åå¯†é’¥ï¼Œ**ç”Ÿäº§ç¯å¢ƒå¿…é¡»æ›´æ¢** |
| `JWT_ALGORITHM` | HS256 | JWT ç­¾åç®—æ³• |
| `JWT_ACCESS_TOKEN_EXPIRE_MINUTES` | 30 | è®¿é—®ä»¤ç‰Œæœ‰æ•ˆæœŸï¼ˆåˆ†é’Ÿï¼‰ |
| `JWT_REFRESH_TOKEN_EXPIRE_DAYS` | 7 | åˆ·æ–°ä»¤ç‰Œæœ‰æ•ˆæœŸï¼ˆå¤©ï¼‰ |

> **å®‰å…¨æé†’ï¼š** éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå‰ï¼ŒåŠ¡å¿…å°† `JWT_SECRET_KEY` æ›´æ¢ä¸ºä¸€ä¸ªéšæœºçš„é«˜å¼ºåº¦å¯†é’¥ã€‚

### 6.3 æœåŠ¡ç›‘æ§ï¼ˆGrafana + Prometheusï¼‰

å¹³å°ä½¿ç”¨ Prometheus é‡‡é›†ç›‘æ§æŒ‡æ ‡ï¼ŒGrafana æä¾›å¯è§†åŒ–ä»ªè¡¨ç›˜ã€‚

**Prometheus é…ç½®æ–‡ä»¶ï¼š** `infrastructure/monitoring/prometheus/prometheus.yml`

**ç›‘æ§ç›®æ ‡ï¼š**

| ä»»åŠ¡åç§° | é‡‡é›†ç›®æ ‡ | ç«¯å£ | è¯´æ˜ |
|---------|---------|------|------|
| backend-api | backend-api:8000 | /metrics | åç«¯ API æœåŠ¡æŒ‡æ ‡ |
| apisix | apisix-gateway:9091 | /apisix/prometheus/metrics | API ç½‘å…³æŒ‡æ ‡ |
| postgres | postgres-exporter:9187 | - | PostgreSQL æ•°æ®åº“æŒ‡æ ‡ |
| redis | redis-exporter:9121 | - | Redis ç¼“å­˜æŒ‡æ ‡ |
| milvus | milvus:9091 | - | å‘é‡æ•°æ®åº“æŒ‡æ ‡ |
| vllm | vllm:8080 | - | LLM æ¨ç†æœåŠ¡æŒ‡æ ‡ |
| node | node-exporter:9100 | - | ä¸»æœºç³»ç»ŸæŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰ |

**é‡‡é›†å‚æ•°ï¼š**
- é‡‡é›†é—´éš”ï¼š15 ç§’
- è¯„ä¼°é—´éš”ï¼š15 ç§’
- é‡‡é›†è¶…æ—¶ï¼š10 ç§’

**Grafana ä»ªè¡¨ç›˜ï¼š** `infrastructure/monitoring/grafana/dashboard.json`

å¯¼å…¥æ–¹å¼ï¼š
1. æ‰“å¼€ Grafana Web ç•Œé¢ï¼ˆé»˜è®¤ http://localhost:3000ï¼‰
2. å·¦ä¾§èœå• â†’ Dashboards â†’ Import
3. ä¸Šä¼  `dashboard.json` æ–‡ä»¶æˆ–ç²˜è´´å†…å®¹
4. é€‰æ‹© Prometheus æ•°æ®æº
5. ç‚¹å‡» Import å®Œæˆå¯¼å…¥

**å‘Šè­¦è§„åˆ™ï¼š** `infrastructure/monitoring/prometheus/alerts.yml`

### 6.4 æ—¥å¿—æŸ¥çœ‹

åç«¯æœåŠ¡ä½¿ç”¨ Python logging æ¨¡å—ï¼Œæ—¥å¿—é…ç½®æ–‡ä»¶ï¼š`backend/app/config/logging_config.py`

**æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š**

```bash
# Docker éƒ¨ç½²æ—¶æŸ¥çœ‹åç«¯æ—¥å¿—
docker logs -f jy-backend --tail 100

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker compose logs -f backend-api
```

**æ—¥å¿—çº§åˆ«æ§åˆ¶ï¼š** é€šè¿‡ `DEBUG` ç¯å¢ƒå˜é‡æ§åˆ¶ï¼š

```env
# .env
DEBUG=false    # ç”Ÿäº§ç¯å¢ƒ
DEBUG=true     # å¼€å‘/è°ƒè¯•ç¯å¢ƒï¼ˆè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼‰
```

---

## 7. SSO é›†æˆ

### 7.1 å­¦æ ¡ç»Ÿä¸€èº«ä»½è®¤è¯å¯¹æ¥

å¹³å°æ”¯æŒä¸å­¦æ ¡ç»Ÿä¸€èº«ä»½è®¤è¯ç³»ç»Ÿï¼ˆSSOï¼‰å¯¹æ¥ï¼Œå®ç°å•ç‚¹ç™»å½•ã€‚

**SSO æµç¨‹ï¼š**

```
ç”¨æˆ·ç‚¹å‡»"SSOç™»å½•" â†’ è·å–ç™»å½•URL â†’ è·³è½¬å­¦æ ¡è®¤è¯é¡µ â†’ è®¤è¯æˆåŠŸå›è°ƒ â†’ éªŒè¯Ticket â†’ åˆ›å»º/å…³è”æœ¬åœ°è´¦å· â†’ ç­¾å‘JWT
```

**ç›¸å…³ API ç«¯ç‚¹ï¼š**

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/api/v1/auth/sso/login-url` | GET | è·å– SSO ç™»å½•è·³è½¬ URL |
| `/api/v1/auth/sso/callback` | POST | å¤„ç† SSO å›è°ƒï¼ŒéªŒè¯ Ticket |
| `/api/v1/auth/sso/logout-url` | GET | è·å– SSO ç™»å‡ºè·³è½¬ URL |

**SSO å›è°ƒè¿”å›ä¿¡æ¯ï¼š**

| å­—æ®µ | è¯´æ˜ |
|------|------|
| `external_id` | å­¦æ ¡ç³»ç»Ÿä¸­çš„ç”¨æˆ·å”¯ä¸€æ ‡è¯† |
| `username` | ç”¨æˆ·å |
| `display_name` | æ˜¾ç¤ºåç§° |
| `email` | é‚®ç®± |
| `role` | è§’è‰²ï¼ˆstudent/teacher/parentï¼‰ |
| `school_id` | å­¦æ ¡ç¼–å· |
| `class_name` | ç­çº§ |
| `grade` | å¹´çº§ |

**é…ç½® SSO Providerï¼š**

SSO é›†æˆé€»è¾‘ä½äº `backend/app/integrations/sso_provider.py`ã€‚æ ¹æ®å­¦æ ¡ SSO ç³»ç»Ÿçš„åè®®ï¼ˆCASã€SAMLã€OAuth2 ç­‰ï¼‰ï¼Œéœ€è¦å®ç°ä»¥ä¸‹æ–¹æ³•ï¼š

- `get_login_url(redirect_url)` -- ç”Ÿæˆç™»å½• URL
- `validate_ticket(ticket)` -- éªŒè¯è®¤è¯ Ticket å¹¶è¿”å›ç”¨æˆ·ä¿¡æ¯
- `get_logout_url(redirect_url)` -- ç”Ÿæˆç™»å‡º URL

**å¯¹æ¥æ­¥éª¤ï¼š**

1. å‘å­¦æ ¡ä¿¡æ¯ä¸­å¿ƒè·å– SSO ç³»ç»Ÿçš„æ¥å£æ–‡æ¡£å’Œæ¥å…¥å‡­æ®ã€‚
2. ä¿®æ”¹ `sso_provider.py` ä¸­çš„å®ç°ï¼Œé€‚é…å­¦æ ¡ SSO åè®®ã€‚
3. åœ¨ `.env` ä¸­é…ç½® SSO ç›¸å…³å‚æ•°ï¼ˆå¦‚ SSO æœåŠ¡åœ°å€ã€Client IDã€Client Secret ç­‰ï¼‰ã€‚
4. æµ‹è¯• SSO ç™»å½•/ç™»å‡ºæµç¨‹ã€‚
5. åœ¨å‰ç«¯æ·»åŠ "SSO ç™»å½•"æŒ‰é’®ï¼ˆå¯é€‰ï¼‰ã€‚

---

## 8. å¸¸è§è¿ç»´æ“ä½œ

### 8.1 åŸºç¡€æ¶æ„ç»„ä»¶

å¹³å°ä¾èµ–ä»¥ä¸‹åŸºç¡€æœåŠ¡ï¼Œé€šè¿‡ Docker Compose ç»Ÿä¸€ç®¡ç†ï¼š

**Docker Compose é…ç½®ï¼š** `infrastructure/docker/docker-compose.yml`

| æœåŠ¡ | é•œåƒ | ç«¯å£ï¼ˆä¸»æœº:å®¹å™¨ï¼‰ | ç”¨é€” |
|------|------|---------|------|
| PostgreSQL | postgres:16-alpine | 5433:5432 | æ ¸å¿ƒå…³ç³»å‹æ•°æ®åº“ |
| Redis | redis:7.4-alpine | 6379:6379 | ç¼“å­˜/æ¶ˆæ¯é˜Ÿåˆ—/é™æµ |
| Milvus | milvusdb/milvus:v2.4.17 | 19530:19530 | å‘é‡æ•°æ®åº“ï¼ˆRAG çŸ¥è¯†æ£€ç´¢ï¼‰ |
| Neo4j | neo4j:5-community | 7474:7474, 7687:7687 | çŸ¥è¯†å›¾è°± |
| MongoDB | mongo:7.0 | 27017:27017 | éç»“æ„åŒ–æ•°æ®å­˜å‚¨ |
| MinIO | minio | 9000:9000, 9001:9001 | å¯¹è±¡å­˜å‚¨ï¼ˆéŸ³é¢‘/å›¾ç‰‡ï¼‰ |
| etcd | quay.io/coreos/etcd:v3.5.16 | - | Milvus å…ƒæ•°æ®å­˜å‚¨ |

### 8.2 æœåŠ¡å¯åŠ¨ä¸åœæ­¢

```bash
# è¿›å…¥ Docker Compose ç›®å½•
cd infrastructure/docker

# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆåå°è¿è¡Œï¼‰
docker compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose ps

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker compose down

# åœæ­¢å¹¶åˆ é™¤æ•°æ®å·ï¼ˆæ…ç”¨ï¼Œä¼šæ¸…é™¤æ‰€æœ‰æ•°æ®ï¼ï¼‰
docker compose down -v
```

### 8.3 æ•°æ®åº“è¿ç§»

æ•°æ®åº“ç»“æ„å˜æ›´é€šè¿‡ Alembic è¿ç§»ç®¡ç†ï¼š

```bash
# æ–¹å¼ä¸€ï¼šåœ¨ Docker å†…æ‰§è¡Œè¿ç§»ï¼ˆæ¨èï¼Œé¿å… Windows ç¼–ç é—®é¢˜ï¼‰
cd infrastructure/docker
docker compose run --rm migrate

# æ–¹å¼äºŒï¼šæœ¬åœ°æ‰§è¡Œï¼ˆéœ€è¦å®‰è£… Python ç¯å¢ƒå’Œä¾èµ–ï¼‰
cd backend
uv run alembic upgrade head

# æŸ¥çœ‹å½“å‰è¿ç§»ç‰ˆæœ¬
uv run alembic current

# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
uv run alembic downgrade -1

# ç”Ÿæˆæ–°çš„è¿ç§»è„šæœ¬
uv run alembic revision --autogenerate -m "æè¿°å˜æ›´å†…å®¹"
```

### 8.4 åç«¯æœåŠ¡å¯åŠ¨

```bash
cd backend

# å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨ uv åŒ…ç®¡ç†å™¨ï¼‰
uv sync

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uv run uvicorn app:create_app --factory --host 0.0.0.0 --port 8000 --reload

# ç”Ÿäº§æ¨¡å¼ï¼ˆå…³é—­çƒ­é‡è½½ï¼‰
uv run uvicorn app:create_app --factory --host 0.0.0.0 --port 8000 --workers 4
```

### 8.5 æ•°æ®åº“è¿æ¥ä¿¡æ¯

| æ•°æ®åº“ | è¿æ¥åœ°å€ | é»˜è®¤ç”¨æˆ· | é»˜è®¤å¯†ç  |
|--------|---------|---------|---------|
| PostgreSQL | localhost:5433 | postgres | postgres |
| Redis | localhost:6379 | - | - |
| Milvus | localhost:19530 | - | - |
| Neo4j | localhost:7687 | neo4j | neo4jpassword |
| MongoDB | localhost:27017 | admin | admin |
| MinIO Console | localhost:9001 | minioadmin | minioadmin |

> **å®‰å…¨æé†’ï¼š** ä»¥ä¸Šä¸ºé»˜è®¤å¼€å‘ç¯å¢ƒå¯†ç ã€‚éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå‰ï¼Œ**å¿…é¡»æ›´æ”¹æ‰€æœ‰é»˜è®¤å¯†ç **ã€‚

### 8.6 å¤‡ä»½ä¸æ¢å¤

**PostgreSQL å¤‡ä»½ï¼š**

```bash
# å¯¼å‡ºå…¨éƒ¨æ•°æ®
docker exec jy-postgres pg_dump -U postgres jy_companion > backup_$(date +%Y%m%d).sql

# æ¢å¤æ•°æ®
docker exec -i jy-postgres psql -U postgres jy_companion < backup_20260226.sql
```

**Redis å¤‡ä»½ï¼š**

```bash
# è§¦å‘ RDB å¿«ç…§
docker exec jy-redis redis-cli BGSAVE

# å¤‡ä»½ RDB æ–‡ä»¶
docker cp jy-redis:/data/dump.rdb ./redis_backup_$(date +%Y%m%d).rdb
```

**MinIO å¤‡ä»½ï¼š**

```bash
# ä½¿ç”¨ mc å®¢æˆ·ç«¯å·¥å…·å¤‡ä»½
mc alias set jy http://localhost:9000 minioadmin minioadmin
mc mirror jy/jy-companion ./minio_backup/
```

**è‡ªåŠ¨å¤‡ä»½ï¼š**

ç”Ÿäº§ç¯å¢ƒå¯ä½¿ç”¨ Kubernetes CronJob å®ç°è‡ªåŠ¨å¤‡ä»½ï¼Œé…ç½®æ¨¡æ¿ä½äºï¼š`infrastructure/k8s/overlays/production/backup-cronjob.yaml`

### 8.7 å¥åº·æ£€æŸ¥

æ‰€æœ‰ Docker æœåŠ¡å‡é…ç½®äº†å¥åº·æ£€æŸ¥ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¡®è®¤å„æœåŠ¡çŠ¶æ€ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„å¥åº·çŠ¶æ€
docker compose ps

# å•ç‹¬æ£€æŸ¥æŸä¸ªæœåŠ¡
docker inspect --format='{{.State.Health.Status}}' jy-postgres
docker inspect --format='{{.State.Health.Status}}' jy-redis
docker inspect --format='{{.State.Health.Status}}' jy-milvus
```

**åç«¯ API å¥åº·æ£€æŸ¥ï¼š**

```bash
# æ£€æŸ¥ API æœåŠ¡æ˜¯å¦æ­£å¸¸
curl http://localhost:8000/health

# æŸ¥çœ‹ Prometheus æŒ‡æ ‡
curl http://localhost:8000/metrics
```

### 8.8 Kubernetes éƒ¨ç½²

ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Kubernetes éƒ¨ç½²ï¼Œé…ç½®æ–‡ä»¶ä½äº `infrastructure/k8s/` ç›®å½•ï¼š

```
infrastructure/k8s/
â”œâ”€â”€ base/                          # åŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”œâ”€â”€ namespace.yaml             # å‘½åç©ºé—´å®šä¹‰
â”‚   â”œâ”€â”€ backend-deployment.yaml    # åç«¯æœåŠ¡éƒ¨ç½²
â”‚   â”œâ”€â”€ backend-service.yaml       # åç«¯æœåŠ¡æš´éœ²
â”‚   â”œâ”€â”€ apisix-deployment.yaml     # API ç½‘å…³éƒ¨ç½²
â”‚   â””â”€â”€ apisix-service.yaml        # API ç½‘å…³æœåŠ¡æš´éœ²
â””â”€â”€ overlays/
    â””â”€â”€ production/                # ç”Ÿäº§ç¯å¢ƒè¦†ç›–é…ç½®
        â”œâ”€â”€ kustomization.yaml
        â”œâ”€â”€ hpa.yaml               # æ°´å¹³è‡ªåŠ¨æ‰©ç¼©å®¹
        â””â”€â”€ backup-cronjob.yaml    # è‡ªåŠ¨å¤‡ä»½ä»»åŠ¡
```

**éƒ¨ç½²å‘½ä»¤ï¼š**

```bash
# éƒ¨ç½²åŸºç¡€ç¯å¢ƒ
kubectl apply -k infrastructure/k8s/base/

# éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒï¼ˆåŒ…å« HPA å’Œè‡ªåŠ¨å¤‡ä»½ï¼‰
kubectl apply -k infrastructure/k8s/overlays/production/
```

### 8.9 API ç½‘å…³ï¼ˆAPISIXï¼‰

å¹³å°ä½¿ç”¨ Apache APISIX ä½œä¸º API ç½‘å…³ï¼Œé…ç½®æ–‡ä»¶ï¼š`infrastructure/gateway/apisix.yaml`

ä¸»è¦åŠŸèƒ½ï¼š
- è·¯ç”±è½¬å‘
- é™æµæ§åˆ¶
- èº«ä»½è®¤è¯
- Prometheus æŒ‡æ ‡é‡‡é›†

### 8.10 å¸¸è§é—®é¢˜æ’æŸ¥

**é—®é¢˜ 1ï¼šåç«¯æœåŠ¡å¯åŠ¨å¤±è´¥**

```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
docker exec jy-postgres pg_isready -U postgres

# æ£€æŸ¥ Redis è¿æ¥
docker exec jy-redis redis-cli ping

# æŸ¥çœ‹åç«¯æ—¥å¿—
docker logs jy-backend --tail 50
```

**é—®é¢˜ 2ï¼šç”¨æˆ·æ— æ³•ç™»å½•**

1. ç¡®è®¤ç”¨æˆ·è´¦å·çŠ¶æ€æ˜¯å¦ä¸º"æ­£å¸¸"ï¼ˆis_active = trueï¼‰
2. ç¡®è®¤ JWT_SECRET_KEY é…ç½®æ˜¯å¦ä¸€è‡´ï¼ˆå‰åç«¯éœ€ä½¿ç”¨åŒä¸€å¯†é’¥ï¼‰
3. æ£€æŸ¥ Redis æ˜¯å¦æ­£å¸¸è¿è¡Œï¼ˆJWT åˆ·æ–°ä»¤ç‰Œå­˜å‚¨åœ¨ Redis ä¸­ï¼‰

**é—®é¢˜ 3ï¼šAI å¯¹è¯æ— å“åº”**

1. æ£€æŸ¥ LLM æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼š`curl http://localhost:8080/health`
2. æ£€æŸ¥ WebSocket è¿æ¥æ˜¯å¦æ­£å¸¸
3. æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­æ˜¯å¦æœ‰ AI æœåŠ¡è°ƒç”¨é”™è¯¯
4. ç¡®è®¤é™æµé…ç½®æ˜¯å¦è¿‡äºä¸¥æ ¼

**é—®é¢˜ 4ï¼šMilvus å‘é‡æ•°æ®åº“è¿æ¥å¤±è´¥**

```bash
# æ£€æŸ¥ Milvus åŠå…¶ä¾èµ–æœåŠ¡çŠ¶æ€
docker compose ps etcd minio-milvus milvus

# æ£€æŸ¥ Milvus å¥åº·çŠ¶æ€
curl http://localhost:9091/healthz

# å¦‚éœ€é‡å¯ï¼ˆæŒ‰é¡ºåºï¼‰
docker compose restart etcd minio-milvus milvus
```

**é—®é¢˜ 5ï¼šMinIO å¯¹è±¡å­˜å‚¨æ— æ³•ä¸Šä¼ æ–‡ä»¶**

```bash
# æ£€æŸ¥ MinIO å¥åº·çŠ¶æ€
curl http://localhost:9000/minio/health/live

# ç™»å½• MinIO æ§åˆ¶å°æŸ¥çœ‹ Bucket çŠ¶æ€
# è®¿é—® http://localhost:9001
# ç”¨æˆ·åï¼šminioadmin  å¯†ç ï¼šminioadmin
```

**é—®é¢˜ 6ï¼šæ•°æ®åº“è¿ç§»å¤±è´¥**

```bash
# æŸ¥çœ‹å½“å‰è¿ç§»çŠ¶æ€
cd backend && uv run alembic current

# æŸ¥çœ‹è¿ç§»å†å²
uv run alembic history

# å¦‚æœè¿ç§»å†²çªï¼Œæ‰‹åŠ¨ä¿®å¤åé‡æ–°æ‰§è¡Œ
uv run alembic stamp head  # æ ‡è®°å½“å‰çŠ¶æ€ï¼ˆæ…ç”¨ï¼‰
uv run alembic upgrade head
```

### 8.11 ç¯å¢ƒå˜é‡å®Œæ•´å‚è€ƒ

ä»¥ä¸‹æ˜¯åç«¯æœåŠ¡æ‰€æœ‰å¯é…ç½®çš„ç¯å¢ƒå˜é‡ï¼Œé…ç½®æ–‡ä»¶ä½äº `backend/.env`ï¼š

```env
# â”€â”€â”€â”€ åº”ç”¨é…ç½® â”€â”€â”€â”€
APP_NAME=JY-Companion API
APP_VERSION=0.1.0
DEBUG=false
API_V1_PREFIX=/api/v1

# â”€â”€â”€â”€ æ•°æ®åº“ â”€â”€â”€â”€
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5433/jy_companion

# â”€â”€â”€â”€ Redis â”€â”€â”€â”€
REDIS_URL=redis://localhost:6379/0

# â”€â”€â”€â”€ JWT è®¤è¯ â”€â”€â”€â”€
JWT_SECRET_KEY=your-production-secret-key
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# â”€â”€â”€â”€ CORS â”€â”€â”€â”€
CORS_ORIGINS=["*"]

# â”€â”€â”€â”€ é™æµ â”€â”€â”€â”€
RATE_LIMIT_STUDENT=100/minute
RATE_LIMIT_TEACHER=500/minute

# â”€â”€â”€â”€ AI æœåŠ¡ â”€â”€â”€â”€
LLM_SERVICE_URL=http://localhost:8080
RAG_SERVICE_URL=http://localhost:8081

# â”€â”€â”€â”€ å†…å®¹å®‰å…¨ â”€â”€â”€â”€
CONTENT_SAFETY_ENABLED=true

# â”€â”€â”€â”€ Milvus å‘é‡æ•°æ®åº“ â”€â”€â”€â”€
MILVUS_HOST=localhost
MILVUS_PORT=19530

# â”€â”€â”€â”€ Neo4j çŸ¥è¯†å›¾è°± â”€â”€â”€â”€
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=neo4jpassword

# â”€â”€â”€â”€ MinIO å¯¹è±¡å­˜å‚¨ â”€â”€â”€â”€
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=jy-companion
```

---

> å¦‚æœ‰è¿ç»´é—®é¢˜æ— æ³•è‡ªè¡Œè§£å†³ï¼Œè¯·è”ç³»å¹³å°å¼€å‘å›¢é˜Ÿæˆ–æŸ¥é˜…é¡¹ç›®ä»“åº“ä¸­çš„æŠ€æœ¯æ–‡æ¡£ã€‚
>
> æ˜Ÿæ¾œå­¦ä¼´ç®¡ç†åå° -- å®ˆæŠ¤å­¦ç”Ÿå­¦ä¹ ä¸æˆé•¿ã€‚
