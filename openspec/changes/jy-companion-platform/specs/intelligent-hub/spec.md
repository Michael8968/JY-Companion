## ADDED Requirements

### Requirement: 用户意图理解与分发

对用户请求进行意图分类，路由至对应智能体处理。

#### Scenario: 学业问题意图识别

- **WHEN** 用户输入"这道二次函数求最大值的题怎么做？"
- **THEN** NLU 服务识别意图为 `academic_math_question`，置信度 ≥0.7
- **AND** 将请求路由至学业辅导智能体

#### Scenario: 情感支持意图识别

- **WHEN** 用户输入"我今天心情不好，考试考砸了"
- **THEN** NLU 服务识别意图为 `emotional_support`，置信度 ≥0.7
- **AND** 将请求路由至情感陪伴智能体

#### Scenario: 低置信度触发澄清

- **WHEN** 意图识别置信度低于 0.7
- **THEN** 系统生成澄清问题引导用户明确需求
- **AND** 用户确认后重新路由至正确的智能体

#### Scenario: 意图识别准确率

- **WHEN** 使用标准测试集评估意图分类模型
- **THEN** 领域内标准场景意图识别准确率 ≥90%
- **AND** 多标签分类 F1 ≥0.85

### Requirement: 多源情景感知与融合

实时采集并融合多维上下文数据，构建情景快照。

#### Scenario: 情景快照生成

- **WHEN** 用户发起新一轮对话
- **THEN** 系统采集时间上下文、设备信息、用户画像、历史对话摘要、情绪基线
- **AND** 生成情景快照 JSON 注入到 LLM Prompt 中
- **AND** 上下文数据完整率 ≥95%

#### Scenario: 情景缓存命中

- **WHEN** 同一会话内用户连续提问
- **THEN** 系统从 LRU 缓存中读取情景快照，缓存命中率 ≥80%
- **AND** 向量化延迟 ≤200ms

### Requirement: 任务规划与智能体协同

对复杂目标进行任务分解，协调多智能体协同工作。

#### Scenario: 复杂任务分解

- **WHEN** 用户请求"帮我制定期末复习计划，包括错题回顾和每日安排"
- **THEN** 任务编排器将目标分解为子任务：错题分析(学业辅导) + 计划制定(生涯规划)
- **AND** 按 DAG 依赖关系并行/串行执行各子任务
- **AND** 任务分解深度 ≤5 层

#### Scenario: 智能体能力匹配

- **WHEN** 子任务需要路由到智能体
- **THEN** 系统通过余弦相似度在能力注册表中匹配最合适的智能体
- **AND** 路由准确率 ≥95%

#### Scenario: 执行超时处理

- **WHEN** 某智能体执行子任务超过 10 秒未返回
- **THEN** 触发超时监控，降级返回部分结果或友好提示
- **AND** 任务执行超时率 ≤1%
