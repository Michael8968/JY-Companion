## ADDED Requirements

### Requirement: 多模态情绪识别

融合文本、语音、视觉多通道数据判断用户情绪状态。

#### Scenario: 文本情绪分析

- **WHEN** 用户发送对话消息
- **THEN** 系统对文本进行情感分析，输出情绪标签（快乐/焦虑/沮丧/平静/愤怒/悲伤/恐惧）
- **AND** 输出效价值 valence [-1, 1] 和唤醒度 arousal [0, 1]
- **AND** 记录情绪波动趋势到 emotion_records 表

#### Scenario: 多模态融合准确率

- **WHEN** 同时接收文本、语音、视觉情绪数据
- **THEN** 通过加权特征融合算法综合判定情绪状态
- **AND** 融合后情绪识别综合准确率 ≥83%，高于单模态 ≥8%

### Requirement: 共情对话生成

调用心理学微调大模型，生成具有共情力和非评判性的回应。

#### Scenario: 共情式回应

- **WHEN** 学生表达"考试考得很差，感觉自己很笨"
- **THEN** 系统生成接纳性、非评判性的回应，承认学生的感受
- **AND** 通过开放性问题引导用户表达和梳理情感
- **AND** 用户情感认可度 ≥85%

#### Scenario: 学伴身份边界

- **WHEN** 学生描述严重的心理困扰
- **THEN** 系统明确自身"学伴"定位，不替代专业心理咨询
- **AND** 提供专业心理援助资源和热线信息

### Requirement: 积极心理学干预策略

内置基于 CBT、正念、积极心理学的标准化干预策略。

#### Scenario: 推荐干预练习

- **WHEN** 系统检测到用户持续焦虑情绪（连续 3 次对话情绪为焦虑）
- **THEN** 推荐呼吸调节、正念冥想等轻量干预练习
- **AND** 策略库包含 ≥50 条标准化干预策略

#### Scenario: 感恩记录

- **WHEN** 用户通过 `POST /api/v1/emotional/gratitude` 提交感恩日记
- **THEN** 系统存储记录并给予正向反馈鼓励
- **AND** 可通过 `GET /api/v1/emotional/gratitude` 查看历史感恩日记

### Requirement: 危机信号识别与预警 [SAFETY-CRITICAL]

识别自伤/自杀倾向等高风险信号，即时触发预警。

#### Scenario: 高风险关键词触发

- **WHEN** 用户消息中出现高风险关键词（自伤/自杀相关词汇列表）
- **THEN** 系统立即触发危机预警协议，不经过 LLM 推理直接走快速通道
- **AND** 向绑定教师、家长、心理专员发送告警通知
- **AND** 预警响应时间 ≤30 秒
- **AND** 高风险信号预警召回率 100%

#### Scenario: 情绪阈值触发

- **WHEN** 用户情绪指标持续处于高度抑郁阈值之上（连续 5 次对话 valence < -0.7）
- **THEN** 系统触发中度预警，通知绑定教师关注
- **AND** 记录完整的预警日志（脱敏后的触发内容、通知角色、响应时间）

#### Scenario: 预警记录与处理

- **WHEN** 管理员查看 `GET /api/v1/admin/alerts`
- **THEN** 返回按状态和时间排序的预警列表（active/acknowledged/resolved）
- **AND** 支持通过 `PUT /api/v1/admin/alerts/{id}/resolve` 标记为已处理
